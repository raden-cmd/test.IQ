<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload Foto</title>
</head>
<body>
  
  <h2>Ambil Foto dari Kamera</h2>
  <video id="video" width="300" autoplay></video>
  <button id="capture">üì∏ Ambil Foto</button>
  <canvas id="canvas" width="300" height="200"></canvas>
  <button id="upload">‚¨ÜÔ∏è Upload ke Firebase</button>

  <!-- Firebase SDK -->
  <script type="module">
    
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Konfigurasi Firebase (punya kamu tempel di sini)
    const firebaseConfig = {
      apiKey: "AIzaSyCI0i2fIl-B7wMPvhyxxZdfPLKEe-nOlVQ",
      authDomain: "foto-doxing.firebaseapp.com",
      projectId: "foto-doxing",
      storageBucket: "foto-doxing.appspot.com",
      messagingSenderId: "839479538330",
      appId: "1:839479538330:web:9e5bef4e323cf96b3e2523",
      measurementId: "G-9X78MHZW9W"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    const db = getFirestore(app);

    // === KAMERA ===
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const captureBtn = document.getElementById("capture");
    const uploadBtn = document.getElementById("upload");

    // Nyalakan kamera
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(err => {
        console.error("Kamera error:", err);
      });

    // Ambil foto
    captureBtn.addEventListener("click", () => {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    });

    // Upload ke Firebase Storage + simpan link di Firestore
    uploadBtn.addEventListener("click", () => {
      canvas.toBlob(async (blob) => {
        const fileName = "foto_" + Date.now() + ".png";
        const storageRef = ref(storage, "uploads/" + fileName);

        try {
          // Upload ke Storage
          await uploadBytes(storageRef, blob);

          // Ambil link download
          const url = await getDownloadURL(storageRef);

          // Simpan ke Firestore
          await addDoc(collection(db, "photos"), {
            url: url,
            createdAt: serverTimestamp()
          });

          alert("‚úÖ Foto berhasil diupload & link tersimpan di Firestore!");
          console.log("Download URL:", url);
        } catch (error) {
          console.error("Upload gagal:", error);
        }
      }, "image/png");
    });
    
  </script>
</body>
  
</html>
