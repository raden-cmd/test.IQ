<!DOCTYPE html>
<html>
<head>
  <title>Upload Foto</title>
</head>
<body>
  <h1>Ambil Foto dari Kamera</h1>
  <video id="camera" autoplay></video>
  <button id="takePhoto">Ambil Foto</button>
  <canvas id="canvas" style="display:none;"></canvas>
  <button id="uploadPhoto">Upload ke Firebase</button>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Config project kamu (yang tadi copy dari Firebase)
    const firebaseConfig = {
      apiKey: "AIzaSyCI0i2fIl-B7wMPvhyxxZdfPLKEe-nOlVQ",
      authDomain: "foto-doxing.firebaseapp.com",
      projectId: "foto-doxing",
      storageBucket: "foto-doxing.appspot.com",
      messagingSenderId: "839479538330",
      appId: "1:839479538330:web:9e5bef4e323cf96b3e2523",
      measurementId: "G-9X78MHZW9W"
    };

    // Inisialisasi Firebase
    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    const db = getFirestore(app);

    // Kamera
    const video = document.getElementById('camera');
    const canvas = document.getElementById('canvas');
    const takePhotoBtn = document.getElementById('takePhoto');
    const uploadBtn = document.getElementById('uploadPhoto');

    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => { video.srcObject = stream });

    takePhotoBtn.onclick = () => {
      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
    };

    uploadBtn.onclick = async () => {
      const dataUrl = canvas.toDataURL('image/png');
      const blob = await (await fetch(dataUrl)).blob();

      const storageRef = ref(storage, 'photos/' + Date.now() + '.png');
      await uploadBytes(storageRef, blob);
      const url = await getDownloadURL(storageRef);

      // Simpan URL ke Firestore
      await addDoc(collection(db, "photos"), {
        url: url,
        createdAt: new Date()
      });

      alert("Foto berhasil diupload!");
    };
  </script>
</body>
</html>
